env:
  - REPO_URL=https://raw.githubusercontent.com/${TRAVIS_PULL_REQUEST_SLUG:-$TRAVIS_REPO_SLUG}/${TRAVIS_PULL_REQUEST_BRANCH:-$TRAVIS_BRANCH}
  
language: python
python:
   - "3.7"
branches:
  only:
    - devel
install:
  - pip install -r requirements.txt
jobs:
  include:
    - stage: build_model
      script: python python/tsv_to_sbml.py
    - stage: basic_tests
      script:
        - python python/tsv_to_sbml.py
        - python python/basic_fba.py
        - python python/restricted_fba.py
    - stage: generate_report
      script: 
        - python python/tsv_to_sbml.py
        - python python/run_memote.py;
        - if [ $TRAVIS_PULL_REQUEST != "false" ]; then
            python python/comment_script.py $GITHUB_TOKEN $TRAVIS_REPO_SLUG $TRAVIS_PULL_REQUEST $DISCORD_ENDPOINT $REPO_URL $TRAVIS_BUILD_NUMBER $TRAVIS_BUILD_WEB_URL;
          else
            python python/PR_merge.py $DISCORD_ENDPOINT $TRAVIS_BUILD_NUMBER $TRAVIS_BUILD_WEB_URL
          fi
        - python python/manage_reports.py

stages:
  - build_model
  - basic_tests
  - generate_report

deploy:
  - provider: pages
    skip_cleanup: true
    github_token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
    keep_history: true
    on:
      branch: devel
      condition: $TRAVIS_PYTHON_VERSION = "3.7"
    target_branch: gh-pages
